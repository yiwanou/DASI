<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Visio</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootswatch@5.1.3/dist/minty/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  </head>
  <body>
    <div class="sidebar">
      <button id="pageAccueil" class="nav-button">
        <a href="accueilEleve.html">Accueil</a>
      </button>
      <button id="pageNouvelleDemande" class="nav-button">
        <a href="nouvelleDemande.html">Nouvelle Demande</a>
      </button>
      <button id="pageHistorique" class="nav-button">
        <a href="historique.html">Historique</a>
      </button>
      <button id="pageVisio" class="nav-button">
        <a href="visio.html">Visio</a>
      </button>
    </div>

    <div class="content">
      <h1>INSTRUCT'IF</h1>
      <h2>Visio</h2>
      <p id="notification">Préparez-vous pour la visio...</p>
      <div class="video-container">
        <video id="localVideo" autoplay muted></video>
        <video id="remoteVideo" autoplay></video>
      </div>
      <div class="btn-container">
        <button class="btn btn-primary" id="startCall">
          Commencer l'appel
        </button>
        <button class="btn btn-danger" id="hangUpCall">Terminer l'appel</button>
      </div>
    </div>

    <script>
      let localStream;
      let remoteStream;
      let peerConnection;
      const configuration = {
        iceServers: [
          {
            urls: "stun:stun.l.google.com:19302",
          },
        ],
      };

      $(document).ready(function () {
        $("#startCall").on("click", async function () {
          $("#notification").html("Démarrage de l'appel...");
          startCall();
        });

        $("#hangUpCall").on("click", function () {
          $("#notification").html("Appel terminé.");
          hangUpCall();
        });
      });

      async function startCall() {
        localStream = await navigator.mediaDevices.getUserMedia({
          video: true,
          audio: true,
        });
        document.getElementById("localVideo").srcObject = localStream;

        peerConnection = new RTCPeerConnection(configuration);
        localStream
          .getTracks()
          .forEach((track) => peerConnection.addTrack(track, localStream));

        peerConnection.ontrack = (event) => {
          remoteStream = event.streams[0];
          document.getElementById("remoteVideo").srcObject = remoteStream;
        };

        peerConnection.onicecandidate = (event) => {
          if (event.candidate) {
            sendIceCandidate(event.candidate);
          }
        };

        const offer = await peerConnection.createOffer();
        await peerConnection.setLocalDescription(offer);
        sendOffer(offer);
      }

      function hangUpCall() {
        peerConnection.close();
        localStream.getTracks().forEach((track) => track.stop());
        document.getElementById("localVideo").srcObject = null;
        document.getElementById("remoteVideo").srcObject = null;
      }

      function sendOffer(offer) {
        // Implement the function to send the offer to the remote peer
      }

      function sendIceCandidate(candidate) {
        // Implement the function to send the ICE candidate to the remote peer
      }

      function handleRemoteAnswer(answer) {
        peerConnection.setRemoteDescription(new RTCSessionDescription(answer));
      }

      function handleRemoteIceCandidate(candidate) {
        peerConnection.addIceCandidate(new RTCIceCandidate(candidate));
      }
    </script>
  </body>
</html>
